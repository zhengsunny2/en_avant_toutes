<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory and Video Management</title>
    <style>
        /* Existing CSS styles */
    </style>
</head>
<body>

    <div class="container">
        <h1>Add New Directory</h1>
        <form id="addCategoryForm" method="POST" action="/add-category">
            <!-- Category Type -->
            <label for="categorieEnum">Category Type:</label>
            <select id="categorieEnum" name="categorieEnum" required>
                <option value="">Select Category Type</option>
                <option value="ENTRAINEMENT">Entrainement</option>
                <option value="NUTRITION">Nutrition</option>
                <option value="DOCUMENTAIRE">Documentaire</option>
            </select>
    
            <!-- Category (Categorie) -->
            <label for="categorie">Category:</label>
            <select id="categorie" name="categorie">
                <option value="">Select Category</option>
            </select>
            <button type="button" id="addCategorieBtn">Add New Category</button>
    
            <!-- SousCategorie (SousCategorie) -->
            <label for="sousCategorie">SousCategorie (SousCategorie):</label>
            <select id="sousCategorie" name="sousCategorie" required>
                <option value="">Select SousCategorie</option>
            </select>
            <button type="button" id="addSousCategorieBtn">Add New SousCategorie</button>
    
            <button type="submit">Add Directory</button>
        </form>
        <div id="categoryResponse" class="response"></div>
    </div>
    
    <script>
        // Handle Category Type Selection
        document.getElementById('categorieEnum').addEventListener('change', function() {
            const selectedType = this.value;
            const categorieSelect = document.getElementById('categorie');
            const sousCategorieSelect = document.getElementById('sousCategorie');
            categorieSelect.innerHTML = '<option value="">Select Category</option>'; // Reset category options
            sousCategorieSelect.innerHTML = '<option value="">Select SousCategorie</option>'; // Reset SousCategorie options
    
            if (selectedType) {
                // Fetch categories based on selected category type
                fetch(`http://localhost:8080/categories/${selectedType}`)
                    .then(response => response.json())
                    .then(categories => {
                        categories.forEach(category => {
                            const option = document.createElement('option');
                            option.value = category.id;
                            option.textContent = category.name;
                            categorieSelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error fetching categories:', error));
            }
        });

        // Handle Add New Category Button
        document.getElementById('addCategorieBtn').addEventListener('click', function() {
            const categoryType = document.getElementById('categorieEnum').value;
            if (categoryType) {
                const newCategoryName = prompt('Enter new category name:');
                if (newCategoryName) {
                    const formData = new FormData();
            formData.append('name', newCategoryName);
            formData.append('type', categoryType);

            fetch('http://localhost:8080/add-category', {
                method: 'POST',
                body: formData // Use FormData to send the parameters
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Category added successfully');
                    // Reload categories after adding new one
                    document.getElementById('categorieEnum').dispatchEvent(new Event('change'));
                } else {
                    alert('Failed to add category');
                }
            })
            .catch(error => console.error('Error adding category:', error));
        }
    } else {
        alert('Please select a category type first.');
    }
});

document.getElementById('addSousCategorieBtn').addEventListener('click', function() {
            const categoryType = document.getElementById('categorieEnum').value;
            const categorieId = document.getElementById('categorie').value;
            if (categoryType && categorieId) {
                const newCategoryName = prompt('Enter new category name:');
                if (newCategoryName) {
                    const formData = new FormData();
                }
            const sousCategorie = {
                name: newCategoryName,
                type: categoryType,
                categorieId: categorieId
            };
fetch(`http://localhost:8080/{categorieId}/add-sousCategorie`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(sousCategorie)
        })
        .then(response => response.json())
        .then(data => {
            alert('Subcategory added successfully!');
        })
        .catch(error => {
            console.error('Error adding subcategory:', error);
            alert('Failed to add subcategory');
        });
    }
    else {
        alert('Please select a category type and category first.');
    }
});

        // Handle Form Submission
        document.getElementById('addCategoryForm').onsubmit = function(event) {
            event.preventDefault();
            const formData = new FormData(this);
    
            fetch('/add-directory', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('categoryResponse').innerText = "Directory added successfully!";
                } else {
                    document.getElementById('categoryResponse').innerText = "Failed to add directory.";
                }
            })
            .catch(error => {
                document.getElementById('categoryResponse').innerText = "Error: " + error.message;
            });
        }
    </script>
</body>
</html>
